<!-- main/templates/diagnostic_oge_snippet.html -->
{% load static %}
{% load custom_filters %}
<div class="diagnostic-full-test">

    <!-- Задания 2–3 (чекбоксы по тексту) -->
    {% if text_task_1_2 %}
    <div class="text-content" style="white-space: pre-wrap; margin-bottom: 20px;">
        {{ text_task_1_2.text_content|bold_words|safe }}
    </div>
    {% for q in text_questions_1_2 %}
    <div class="question" data-question-number="{{ q.question_number }}">
        <h4>{{ q.question_number }}. {{ q.question_text }}</h4>
        {% if q.question_type == 'missing_word' %}
        <input type="text" data-question="{{ q.question_number }}" placeholder="Ответ">
        {% else %}
        {% for opt in q.options.all %}
        <label>
            <input type="checkbox" value="{{ opt.option_number }}" data-question="{{ q.question_number }}">
            <span>{{ opt.option_number }}) {{ opt.option_text }}</span>
        </label><br>
        {% endfor %}
        {% endif %}
    </div>
    <hr>
    {% endfor %}
    {% endif %}

    <!-- Задание 4: Синтаксический анализ (Сопоставление) -->
    {% if task3_error_type_names %}
    <div class="question" data-question-number="4">
        <h4>4. Установите соответствие между пунктуационными правилами и предложениями, которые могут служить примерами
            для приведённых пунктуационных правил. К каждой позиции первого столбца подберите соответствующую позицию из
            второго столбца.</h4>

        <div class="task-match-container">
            <div class="task-match-left-column">
                <h4 class="task-match-column-title">ПУНКТУАЦИОННЫЕ ПРАВИЛА</h4>
                {% for letter, name in task3_error_type_names.items %}
                <div class="task-match-row task-eight-error-row" data-error-letter="{{ letter }}">
                    <select class="error-select" data-letter="{{ letter }}">
                        <option value="-">—</option>
                        {% for i in "12345" %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                    <span class="task-match-letter">{{ letter }})</span>
                    <div class="task-match-content">{{ name }}</div>
                </div>
                {% endfor %}
            </div>

            <div class="task-match-right-column">
                <h4 class="task-match-column-title">ПРЕДЛОЖЕНИЯ</h4>
                {% for item in task3_sentences %}
                <div class="task-match-row task-eight-sentence-row" data-sentence-number="{{ item.position }}">
                    <span class="task-match-item-number">{{ item.position }})</span>
                    <span class="task-match-content">{{ item.text }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <hr>
    {% endif %}

    <!-- Задание 5: Пунктуация — смайлики -->
    {% if task4_data %}
    <div class="question" data-question-number="5">
        {% if task4_data.title %}
        <h4>{{ task4_data.title }}</h4>
        {% else %}
        <h4>5. Расставьте знаки препинания. Кликните на смайлик и выберите правильный знак.</h4>
        {% endif %}

        {% if task4_data.image_name %}
        <div style="margin: 15px 0; text-align: center;">
            <img src="{% static task4_data.image_name %}" alt="Задание 5" style="max-width: 100%; height: auto;">
        </div>
        {% endif %}

        {% for line in task4_data.lines %}
        <div><span class="practice-line">{{ line|safe }}</span></div>
        {% endfor %}
    </div>
    <hr>
    {% endif %}

    <!-- Задание 6: Чекбоксы по тексту -->
    {% if text_task_5 %}
    <div class="text-content" style="white-space: pre-wrap; margin-bottom: 20px;">
        {{ text_task_5.text_content|bold_words|safe }}
    </div>
    {% for q in text_questions_5 %}
    <div class="question" data-question-number="{{ q.question_number }}">
        <h4>{{ q.question_number }}. {{ q.question_text }}</h4>
        {% if q.question_type == 'missing_word' or q.question_type == 'free_text' %}
        <input type="text" data-question="{{ q.question_number }}" placeholder="Ответ">
        {% else %}
        {% for opt in q.options.all %}
        <label>
            <input type="checkbox" value="{{ opt.option_number }}" data-question="{{ q.question_number }}">
            <span>{{ opt.option_number }}) {{ opt.option_text }}</span>
        </label><br>
        {% endfor %}
        {% endif %}
    </div>
    <hr>
    {% endfor %}
    {% endif %}

    <!-- Задание 7: Смайлики букв -->
    {% if task6_lines %}
    <div class="question" data-question-number="7">
        <h4>7. Выберите правильную букву, кликнув на смайлик.</h4>
        {% for line in task6_lines %}
        <div>{{ forloop.counter }}) <span class="practice-line">{{ line.display_line|safe }}</span></div>
        {% endfor %}
    </div>
    <hr>
    {% endif %}

    <!-- Задание 8: Раскройте скобки -->
    {% if task7_word %}
    <div class="question" data-question-number="8">
        <h4>8. Раскройте скобки и запишите слово «{{ task7_word }}» в соответствующей форме, соблюдая нормы
            современного
            русского литературного языка.</h4>
        {% if task7_sentence %}
        <p style="margin: 10px 0; font-size: 1.05em;">{{ task7_sentence }}</p>
        {% endif %}
        <input type="text" data-question="8" placeholder="Впиши слово"
            style="width: 60%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px;">
    </div>
    <hr>
    {% endif %}

    <!-- Задание 9: Словосочетание -->
    {% if wordok_8 %}
    <div class="question" data-question-number="9">
        <h4>9. {{ wordok_8.text }}</h4>
        <input type="text" data-question="9" placeholder="Впиши словосочетание"
            style="width: 60%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px;">
    </div>
    <hr>
    {% endif %}

    <!-- Задания 10–11: Чекбоксы по тексту (без отдельного заголовка секции) -->
    {% if text_task_9_10 %}
    <div class="text-content" style="white-space: pre-wrap; margin-bottom: 20px;">
        {{ text_task_9_10.text_content|bold_words|safe }}
    </div>
    {% for q in text_questions_9_10 %}
    <div class="question" data-question-number="{{ q.question_number }}">
        <h4>{{ q.question_number }}. {{ q.question_text }}</h4>
        {% if q.question_type == 'missing_word' or q.question_type == 'free_text' %}
        <input type="text" data-question="{{ q.question_number }}" placeholder="Ответ">
        {% else %}
        {% for opt in q.options.all %}
        <label>
            <input type="checkbox" value="{{ opt.option_number }}" data-question="{{ q.question_number }}">
            <span>{{ opt.option_number }}) {{ opt.option_text }}</span>
        </label><br>
        {% endfor %}
        {% endif %}
    </div>
    <hr>
    {% endfor %}
    {% endif %}

    <!-- Задание 12: Инпут (без повторного текста — он уже выше) -->
    {% if text_questions_11 %}
    {% for q in text_questions_11 %}
    <div class="question" data-question-number="{{ q.question_number }}">
        <h4>{{ q.question_number }}. {{ q.question_text }}</h4>
        <input type="text" data-question="{{ q.question_number }}" placeholder="Впиши здесь"
            style="width: 60%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px;">
    </div>
    <hr>
    {% endfor %}
    {% endif %}

    <!-- JSON-данные для JS (смайлики) -->
    <script id="task4-letter-groups" type="application/json">
        {{ task4_letter_groups|safe }}
    </script>
    <script id="task4-subgroup-letters" type="application/json">
        {{ task4_subgroup_letters|safe }}
    </script>
    <script id="task6-letter-groups" type="application/json">
        {{ task6_letter_groups|safe }}
    </script>
    <script id="task6-subgroup-letters" type="application/json">
        {{ task6_subgroup_letters|safe }}
    </script>

</div>