#!/usr/bin/env python
"""Обновляет тестовые данные заданий 9-11 текстами с фото ОГЭ (Шмелёв)."""
import os, django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'main.settings')
django.setup()
from main.models import OgeTextAnalysisTask, OgeTextQuestion, OgeQuestionOption

# Удаляем старые данные для 9-11
OgeQuestionOption.objects.filter(question__question_number__in=[9, 10, 11]).delete()
OgeTextQuestion.objects.filter(question_number__in=[9, 10, 11]).delete()
OgeTextAnalysisTask.objects.filter(title__icontains='дружб').delete()
OgeTextAnalysisTask.objects.filter(title__icontains='книг').delete()

# === ТЕКСТ Шмелёва для заданий 9-11 ===
text_9_11, _ = OgeTextAnalysisTask.objects.update_or_create(
    title="Текст И.С. Шмелёва (задания 9–11)",
    defaults={
        'text_content': (
            '(1)Впервые я увидал дядю, когда мне было лет девять. '
            '(2)Мы только что приехали из другого города, где я родился, а дядя по старости не выезжал никуда '
            'и, должно быть, знал обо мне только по письмам. '
            '(3)У нас часто говорили о нём, называли странным и «книжным» человеком, пожимали плечами и удивлялись, '
            'что он слишком много тратит на какие-то никому не нужные вещи. '
            '(4)Я ждал с нетерпением, когда меня повезут к нему, но поездку откладывали со дня на день.\n'
            '(5)Случилось как-то, что нашего дворника послали к дяде с запиской, и я, '
            'потеряв терпение, не сказав никому ни слова, отправился самостоятельно. '
            '(6)Это было моё первое самостоятельное путешествие.\n'
            '(7)У меня постукивало сердце, когда я поднимался по лестнице, но, когда '
            'старичок-слуга снял с меня шубку и впустил в комнаты, я потерялся. '
            '(8)В комнатах совсем не было стен, по крайней мере я их не видел. '
            '(9)Были пол, потолок, окна, двери и... книги. '
            '(10)Они шли стройными рядами всюду, куда я ни глядел, '
            'в решётчатых полках, точно их собрали сюда со всего света. '
            '(11)На самой крайней полочке, совсем под потолком, сидела большая голубоватая сова. '
            '(12)В комнате стоял полумрак и было тихо, торжественно-тихо, как в пустой церкви.\n'
            '(13)В углу, у окна, в глубоком кожаном кресле сидел он, мой дядя, и держал книгу. '
            '(14)На коврике, у его ног, спал крупный дымчатый кот. '
            '(15)Я стоял в дверях, не решался переступить. '
            '(16)Дядя услышал шорох, повернул голову, и я увидал худое, плохо выбритое лицо '
            'и всматривающиеся в темноту усталые глаза. '
            '(17)Казалось, он старался понять, кто я такой. '
            '(18)Путаясь в словах, я объяснился.\n'
            '— (19)Поди-ка сюда, голова, — сказал он и поманил пальцем.\n'
            '(20)Я приблизился с чувством благоговения и некоторого страха.\n'
            '— (21)Вот ты какой, — сказал дядя и потрепал меня по щеке. '
            '— (22)Каков, однако, ферт! (23)Один заявился!.. '
            '(24)Ну, здравствуй. (25)Так это ты большой любитель чтения?\n'
            '(26)В тоне голоса я уловил похвалу и из скромности опустил глаза.\n'
            '— (27)Очень рад тебя видеть...\n'
            '(28)Из проволочной корзинки он достал яблоко и дал мне.\n'
            '(29)Через пять минут я чувствовал себя как дома, сидел на скамеечке, рядом '
            'с храпевшим котом, глазел на поразившие меня ряды книг.\n'
            '— (30)Ну что ты читал, дружок? — спрашивал дядя.\n'
            '...\n'
            '(57)Должно быть, радость, которую я пережил в этот момент, отразилась на моей '
            'физиономии: дядя взял меня за подбородок и, глядя в глаза, сказал:\n'
            '— Книги, которые я буду давать тебе, можешь оставлять у себя. '
            '(58)Пусть это будет началом твоей библиотеки. (59)Пусть они будут твоими друзьями.\n'
            '(60)Как это было давно, но как до сих пор ярко встаёт в моей памяти!\n'
            '(61)В тот памятный вечер в моём сердце затеплилась искра. '
            '(62)Почти строгий тон дядиных слов, когда говорил он о книгах, чёрные молчаливые ряды на полках '
            'и грустные сумерки — всё это будило во мне тихое чувство благоговения.\n\n'
            '(По И. С. Шмелёву*)\n'
            '* Иван Сергеевич Шмелёв (1873–1950) — русский писатель, мыслитель, публицист.'
        ),
        'order': 3,
        'is_active': True,
    }
)

# === Задание 9: содержание текста ===
q9, _ = OgeTextQuestion.objects.update_or_create(
    task=text_9_11, question_number=9,
    defaults={
        'question_type': 'multiple_choice',
        'question_text': 'Какие из высказываний соответствуют содержанию текста? Укажите номера ответов, кликнув по чек-боксам.',
        'correct_answer': '15',
    }
)
opts_9 = [
    (1, 'В семье рассказчика к дяде относились настороженно, называли странным человеком.', True),
    (2, 'Больше всего в комнате дяди рассказчика поразили огромные книжные полки, озарённые ярким светом.', False),
    (3, 'Рассказчик ушёл от дяди домой, взяв с собой книжку про солдат и разбойников.', False),
    (4, 'Дядя искренне удивился огромным познаниям племянника в области классической литературы.', False),
    (5, 'Воспоминания о вечере знакомства с дядей рассказчик хранил в сердце много лет.', True),
]
OgeQuestionOption.objects.filter(question=q9).delete()
for num, text, correct in opts_9:
    OgeQuestionOption.objects.create(question=q9, option_number=num, option_text=text, is_correct=correct)

# === Задание 10: метафора ===
q10, _ = OgeTextQuestion.objects.update_or_create(
    task=text_9_11, question_number=10,
    defaults={
        'question_type': 'multiple_choice',
        'question_text': 'Укажите варианты ответов, в которых средством выразительности речи является метафора, кликнув по чек-боксам.',
        'correct_answer': '35',
    }
)
opts_10 = [
    (1, 'Я ждал с нетерпением, когда меня повезут к нему, но поездку откладывали со дня на день.', False),
    (2, 'Дядя услышал шорох, повернул голову, и я увидал худое, плохо выбритое лицо и всматривающиеся в темноту усталые глаза.', False),
    (3, 'В тот памятный вечер в моём сердце затеплилась искра.', True),
    (4, '— Книга не Петрушка, — продолжал дядя, тряся пальцем, — она не для смеху пишется!', False),
    (5, 'Каждая из них — часть сердца человека, которого называют писателем!', True),
]
OgeQuestionOption.objects.filter(question=q10).delete()
for num, text, correct in opts_10:
    OgeQuestionOption.objects.create(question=q10, option_number=num, option_text=text, is_correct=correct)

# === Задание 11: фразеологизм ===
q11, _ = OgeTextQuestion.objects.update_or_create(
    task=text_9_11, question_number=11,
    defaults={
        'question_type': 'free_text',
        'question_text': 'В предложениях 26–34 найдите фразеологизм с лексическим значением «свободно, без стеснения, хорошо». Выпишите этот фразеологизм.',
        'correct_answer': 'как дома',
    }
)

print(f"✓ Текст: «{text_9_11.title}»")
print(f"✓ Задание 9: {OgeQuestionOption.objects.filter(question=q9).count()} опций")
print(f"✓ Задание 10: {OgeQuestionOption.objects.filter(question=q10).count()} опций")
print(f"✓ Задание 11: свободный ответ")
print("✅ Данные 9–11 обновлены!")
